[
  {
    "path": "posts/2020-12-23-a-workflow-with-labelled-data/",
    "title": "A workflow with labelled data",
    "description": "I love labelled data.",
    "author": [
      {
        "name": "Lefkios  Paikousis",
        "url": "https://example.com/norajones"
      }
    ],
    "date": "2020-12-23",
    "categories": [],
    "contents": "\r\n\r\nContents\r\nThe Libraries\r\nRead the data and data-dictionary\r\nFactors and order of the value labels\r\nPlots\r\nAxis titles\r\nFacet strip labels\r\nAxis text labels\r\n\r\n\r\nThe Libraries\r\n\r\n\r\nlibrary(tidyverse)\r\nlibrary(labelled)\r\nlibrary(gtsummary)\r\nlibrary(readxl)\r\n\r\n\r\n\r\nI usually work with survey data that come in the form of a spreadsheet (usually from google forms).\r\nThe variable names are long and highly descriptive of what information the variable contains, but that long of a name, makes it very hard to work with while wrangling the dataset.\r\nWhat I want is to keep the original variable name as a label and rename the variable names with new names\r\nTo demontrate my workflow, I created a sample dataset to work with. You can download it from github\r\nThe dataset is stored as an excel file, and has two worksheets.\r\nIn the worksheet data you can see the raw data, and\r\nIn the worksheet labels you can find a sort of data dictionary\r\nIn the labels worksheet I keep a record of the original variable names as label and on the adjacent column, I type a short but readable column name for the variable.\r\nworksheet:labelsRead the data and data-dictionary\r\nLet’s read in the data\r\n\r\n\r\npath = here::here(\"Data\", \"sample_survey.xlsx\")\r\ndta <- readxl::read_xlsx(path)\r\n\r\nglimpse(dta)\r\n\r\n\r\nRows: 7\r\nColumns: 6\r\n$ id                                   <dbl> 1, 2, 3, 4, 5, 6, 7\r\n$ `Which restaurant have you visited?` <chr> \"Limassol\", \"Nicosia...\r\n$ `I am happy with the greeting`       <chr> \"Agree\", \"Strongly d...\r\n$ `I enjoyed the food`                 <chr> \"Neutral\", \"Neutral\"...\r\n$ `I am  satisfied with the cost`      <chr> \"Agree\", \"Strongly d...\r\n$ `How satisfied you are overall`      <chr> \"Very satisfied\", \"V...\r\n\r\nThe dataset contains 6 columns\r\nRead in the labels worksheet for the column dictionary\r\n\r\n\r\ndta_labels <- readxl::read_xlsx(path, sheet = \"labels\")\r\n\r\ndta_labels\r\n\r\n\r\n# A tibble: 6 x 2\r\n  label                              name      \r\n  <chr>                              <chr>     \r\n1 id                                 id        \r\n2 Which restaurant have you visited? restaurant\r\n3 I am happy with the greeting       greeting  \r\n4 I enjoyed the food                 food      \r\n5 I am  satisfied with the cost      cost      \r\n6 How satisfied you are overall      overall   \r\n\r\nNow,\r\nChange the column names of the dataset to the short names in the dictionary\r\nSet the labels of the columns via the labelled::var_label() function\r\nCreate a label_list object, which is a named list where the names of the list are variable names and the values of the list are the variable labels\r\nAlso, save a label_vector named vector with the same informationas the label_list\r\n\r\n\r\nnames(dta) <- dta_labels$name\r\n\r\nvar_label(dta) <- dta_labels$label\r\n\r\nlabels_list <- var_label(dta)\r\nlabels_vector <-  var_label(dta, unlist = TRUE)\r\n\r\nlabels_list\r\n\r\n\r\n$id\r\n[1] \"id\"\r\n\r\n$restaurant\r\n[1] \"Which restaurant have you visited?\"\r\n\r\n$greeting\r\n[1] \"I am happy with the greeting\"\r\n\r\n$food\r\n[1] \"I enjoyed the food\"\r\n\r\n$cost\r\n[1] \"I am  satisfied with the cost\"\r\n\r\n$overall\r\n[1] \"How satisfied you are overall\"\r\n\r\nHave a look at the dataset names now\r\n\r\n\r\nglimpse(dta)\r\n\r\n\r\nRows: 7\r\nColumns: 6\r\n$ id         <dbl> 1, 2, 3, 4, 5, 6, 7\r\n$ restaurant <chr> \"Limassol\", \"Nicosia\", \"Nicosia\", \"Larnaka\", \"...\r\n$ greeting   <chr> \"Agree\", \"Strongly disagree\", \"Neutral\", \"Neut...\r\n$ food       <chr> \"Neutral\", \"Neutral\", \"Strongly agree\", \"Neutr...\r\n$ cost       <chr> \"Agree\", \"Strongly disagree\", \"Agree\", \"Strong...\r\n$ overall    <chr> \"Very satisfied\", \"Very dissatisfied\", \"Neutra...\r\n\r\nNow its very easy to keep using the variable names in your code, but variable labels are rendered in the tables when using {gtsummary} for example.\r\n\r\n\r\ndta %>%\r\n  select(overall,restaurant) %>% \r\n  tbl_summary(\r\n    by  = restaurant\r\n  ) \r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#fatnaaiwby .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#fatnaaiwby .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fatnaaiwby .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#fatnaaiwby .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#fatnaaiwby .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#fatnaaiwby .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fatnaaiwby .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#fatnaaiwby .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#fatnaaiwby .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#fatnaaiwby .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#fatnaaiwby .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#fatnaaiwby .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#fatnaaiwby .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#fatnaaiwby .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#fatnaaiwby .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#fatnaaiwby .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#fatnaaiwby .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#fatnaaiwby .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#fatnaaiwby .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#fatnaaiwby .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#fatnaaiwby .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#fatnaaiwby .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#fatnaaiwby .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#fatnaaiwby .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fatnaaiwby .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#fatnaaiwby .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#fatnaaiwby .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#fatnaaiwby .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#fatnaaiwby .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#fatnaaiwby .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#fatnaaiwby .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#fatnaaiwby .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#fatnaaiwby .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#fatnaaiwby .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#fatnaaiwby .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-size: 65%;\r\n}\r\nCharacteristic\r\n      Larnaka, N = 11\r\n      Limassol, N = 21\r\n      Mall, N = 11\r\n      Nicosia, N = 21\r\n      Pafos, N = 11\r\n    How satisfied you are overall\r\n      \r\n      \r\n      \r\n      \r\n      \r\n    Dissatisfied\r\n      0 (0%)\r\n      0 (0%)\r\n      1 (100%)\r\n      0 (0%)\r\n      0 (0%)\r\n    Neutral\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n      1 (50%)\r\n      1 (100%)\r\n    Satisfied\r\n      1 (100%)\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n    Very dissatisfied\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n      1 (50%)\r\n      0 (0%)\r\n    Very satisfied\r\n      0 (0%)\r\n      2 (100%)\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n    \r\n        \r\n          1\r\n          \r\n           \r\n          Statistics presented: n (%)\r\n          \r\n      \r\n    \r\n\r\nFactors and order of the value labels\r\nThe order of the satifaction levels in the previous table, is not the most appropriate. It should read from Very dissatisfied down to Very satisfied.\r\nOne way to accomplish this is to turn the variable into a factor. However, one problem arises now, where the label for the overall variable is gone. That is an inherent behaviour of dplyr::mutate() where it removes these attributes off of the variables that you manipulate.\r\nSee the overall title in the table below\r\n\r\n\r\n# change `overall` to factor\r\ndta <- \r\n  dta %>%\r\n  mutate(\r\n    overall  =  factor(overall,levels  = c(\"Very dissatisfied\", \"Dissatisfied\", \"Neutral\",\r\n                                           \"Satisfied\",\"Very satisfied\"))\r\n  ) \r\n\r\ndta %>% \r\n  select(overall,restaurant) %>% \r\n  tbl_summary(\r\n    by  = restaurant\r\n  ) \r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#bagskacclh .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#bagskacclh .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#bagskacclh .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#bagskacclh .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#bagskacclh .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#bagskacclh .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#bagskacclh .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#bagskacclh .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#bagskacclh .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#bagskacclh .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#bagskacclh .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#bagskacclh .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#bagskacclh .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#bagskacclh .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#bagskacclh .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#bagskacclh .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#bagskacclh .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#bagskacclh .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#bagskacclh .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#bagskacclh .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#bagskacclh .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#bagskacclh .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#bagskacclh .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#bagskacclh .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#bagskacclh .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#bagskacclh .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#bagskacclh .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#bagskacclh .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#bagskacclh .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#bagskacclh .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#bagskacclh .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#bagskacclh .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#bagskacclh .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#bagskacclh .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#bagskacclh .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-size: 65%;\r\n}\r\nCharacteristic\r\n      Larnaka, N = 11\r\n      Limassol, N = 21\r\n      Mall, N = 11\r\n      Nicosia, N = 21\r\n      Pafos, N = 11\r\n    overall\r\n      \r\n      \r\n      \r\n      \r\n      \r\n    Very dissatisfied\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n      1 (50%)\r\n      0 (0%)\r\n    Dissatisfied\r\n      0 (0%)\r\n      0 (0%)\r\n      1 (100%)\r\n      0 (0%)\r\n      0 (0%)\r\n    Neutral\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n      1 (50%)\r\n      1 (100%)\r\n    Satisfied\r\n      1 (100%)\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n    Very satisfied\r\n      0 (0%)\r\n      2 (100%)\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n    \r\n        \r\n          1\r\n          \r\n           \r\n          Statistics presented: n (%)\r\n          \r\n      \r\n    \r\n\r\nYou can easily solve this, using the labelled::set_variable_names() function. This function can be used in the dplyr chain since it takes a data argument.\r\nWhat you need to use is the labels_list we have saved before and pass it in the .labels argument of the set_variable_names()\r\n\r\n\r\ndta <- \r\n  dta %>%\r\n  set_variable_labels(.labels=labels_list)  #After mutating, the label information of the `overall` variable is gone.\r\n\r\ndta %>% \r\n  select(overall,restaurant) %>% \r\n  tbl_summary(\r\n    by  = restaurant\r\n  ) \r\n\r\n\r\nhtml {\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\r\n}\r\n\r\n#rxxotdcpsu .gt_table {\r\n  display: table;\r\n  border-collapse: collapse;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  color: #333333;\r\n  font-size: 16px;\r\n  font-weight: normal;\r\n  font-style: normal;\r\n  background-color: #FFFFFF;\r\n  width: auto;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #A8A8A8;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #A8A8A8;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n}\r\n\r\n#rxxotdcpsu .gt_heading {\r\n  background-color: #FFFFFF;\r\n  text-align: center;\r\n  border-bottom-color: #FFFFFF;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#rxxotdcpsu .gt_title {\r\n  color: #333333;\r\n  font-size: 125%;\r\n  font-weight: initial;\r\n  padding-top: 4px;\r\n  padding-bottom: 4px;\r\n  border-bottom-color: #FFFFFF;\r\n  border-bottom-width: 0;\r\n}\r\n\r\n#rxxotdcpsu .gt_subtitle {\r\n  color: #333333;\r\n  font-size: 85%;\r\n  font-weight: initial;\r\n  padding-top: 0;\r\n  padding-bottom: 4px;\r\n  border-top-color: #FFFFFF;\r\n  border-top-width: 0;\r\n}\r\n\r\n#rxxotdcpsu .gt_bottom_border {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#rxxotdcpsu .gt_col_headings {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#rxxotdcpsu .gt_col_heading {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#rxxotdcpsu .gt_column_spanner_outer {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: normal;\r\n  text-transform: inherit;\r\n  padding-top: 0;\r\n  padding-bottom: 0;\r\n  padding-left: 4px;\r\n  padding-right: 4px;\r\n}\r\n\r\n#rxxotdcpsu .gt_column_spanner_outer:first-child {\r\n  padding-left: 0;\r\n}\r\n\r\n#rxxotdcpsu .gt_column_spanner_outer:last-child {\r\n  padding-right: 0;\r\n}\r\n\r\n#rxxotdcpsu .gt_column_spanner {\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: bottom;\r\n  padding-top: 5px;\r\n  padding-bottom: 6px;\r\n  overflow-x: hidden;\r\n  display: inline-block;\r\n  width: 100%;\r\n}\r\n\r\n#rxxotdcpsu .gt_group_heading {\r\n  padding: 8px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#rxxotdcpsu .gt_empty_group_heading {\r\n  padding: 0.5px;\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  vertical-align: middle;\r\n}\r\n\r\n#rxxotdcpsu .gt_from_md > :first-child {\r\n  margin-top: 0;\r\n}\r\n\r\n#rxxotdcpsu .gt_from_md > :last-child {\r\n  margin-bottom: 0;\r\n}\r\n\r\n#rxxotdcpsu .gt_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  margin: 10px;\r\n  border-top-style: solid;\r\n  border-top-width: 1px;\r\n  border-top-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 1px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 1px;\r\n  border-right-color: #D3D3D3;\r\n  vertical-align: middle;\r\n  overflow-x: hidden;\r\n}\r\n\r\n#rxxotdcpsu .gt_stub {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  font-size: 100%;\r\n  font-weight: initial;\r\n  text-transform: inherit;\r\n  border-right-style: solid;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n  padding-left: 12px;\r\n}\r\n\r\n#rxxotdcpsu .gt_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#rxxotdcpsu .gt_first_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#rxxotdcpsu .gt_grand_summary_row {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  text-transform: inherit;\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n#rxxotdcpsu .gt_first_grand_summary_row {\r\n  padding-top: 8px;\r\n  padding-bottom: 8px;\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n  border-top-style: double;\r\n  border-top-width: 6px;\r\n  border-top-color: #D3D3D3;\r\n}\r\n\r\n#rxxotdcpsu .gt_striped {\r\n  background-color: rgba(128, 128, 128, 0.05);\r\n}\r\n\r\n#rxxotdcpsu .gt_table_body {\r\n  border-top-style: solid;\r\n  border-top-width: 2px;\r\n  border-top-color: #D3D3D3;\r\n  border-bottom-style: solid;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n}\r\n\r\n#rxxotdcpsu .gt_footnotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#rxxotdcpsu .gt_footnote {\r\n  margin: 0px;\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#rxxotdcpsu .gt_sourcenotes {\r\n  color: #333333;\r\n  background-color: #FFFFFF;\r\n  border-bottom-style: none;\r\n  border-bottom-width: 2px;\r\n  border-bottom-color: #D3D3D3;\r\n  border-left-style: none;\r\n  border-left-width: 2px;\r\n  border-left-color: #D3D3D3;\r\n  border-right-style: none;\r\n  border-right-width: 2px;\r\n  border-right-color: #D3D3D3;\r\n}\r\n\r\n#rxxotdcpsu .gt_sourcenote {\r\n  font-size: 90%;\r\n  padding: 4px;\r\n}\r\n\r\n#rxxotdcpsu .gt_left {\r\n  text-align: left;\r\n}\r\n\r\n#rxxotdcpsu .gt_center {\r\n  text-align: center;\r\n}\r\n\r\n#rxxotdcpsu .gt_right {\r\n  text-align: right;\r\n  font-variant-numeric: tabular-nums;\r\n}\r\n\r\n#rxxotdcpsu .gt_font_normal {\r\n  font-weight: normal;\r\n}\r\n\r\n#rxxotdcpsu .gt_font_bold {\r\n  font-weight: bold;\r\n}\r\n\r\n#rxxotdcpsu .gt_font_italic {\r\n  font-style: italic;\r\n}\r\n\r\n#rxxotdcpsu .gt_super {\r\n  font-size: 65%;\r\n}\r\n\r\n#rxxotdcpsu .gt_footnote_marks {\r\n  font-style: italic;\r\n  font-size: 65%;\r\n}\r\nCharacteristic\r\n      Larnaka, N = 11\r\n      Limassol, N = 21\r\n      Mall, N = 11\r\n      Nicosia, N = 21\r\n      Pafos, N = 11\r\n    How satisfied you are overall\r\n      \r\n      \r\n      \r\n      \r\n      \r\n    Very dissatisfied\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n      1 (50%)\r\n      0 (0%)\r\n    Dissatisfied\r\n      0 (0%)\r\n      0 (0%)\r\n      1 (100%)\r\n      0 (0%)\r\n      0 (0%)\r\n    Neutral\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n      1 (50%)\r\n      1 (100%)\r\n    Satisfied\r\n      1 (100%)\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n    Very satisfied\r\n      0 (0%)\r\n      2 (100%)\r\n      0 (0%)\r\n      0 (0%)\r\n      0 (0%)\r\n    \r\n        \r\n          1\r\n          \r\n           \r\n          Statistics presented: n (%)\r\n          \r\n      \r\n    \r\n\r\nImportant to say that:\r\nUsing the labels_list object we do not worry about the order of the variables as the matchingis done on the names of the variables.\r\nThere is no problem if the data has more variables than what the labels_list contains as long as all the variables contained in the labels_list are also in the dataset we want to label\r\nPlots\r\nAxis titles\r\nHere, we want to utilise the labels we stored on the labels_list when defining axes title labels.\r\nHere is the plot with the default varible names as the xes title labels\r\n\r\n\r\nplot_overall <- \r\n  dta %>%\r\n  count(overall) %>% \r\n  ggplot(aes(overall, n))+\r\n  geom_col()+\r\n  coord_flip()\r\n\r\nplot_overall\r\n\r\n\r\n\r\n\r\nNow, you don;t need to type in manually the axis title label. Just use the labels_list\r\n\r\n\r\nplot_overall  +\r\n  labs(x=labels_list[[\"overall\"]])\r\n\r\n\r\n\r\n\r\nFacet strip labels\r\nHere, we will utilise the labels_vector to show descriptive labels in the facet_warp strip texts\r\nUsually, with these kind of questions(a series of likert scale questions), I want to plot many questions at the same plot. One way to do this is by tranforming all the data into a long format and get the counts (or proportions) of ech response to each question in a long table. Then we plot it by faceting the graph by the question.\r\n\r\n\r\nfaceted_plot <- \r\n  dta %>%\r\n  select(greeting, food, cost) %>% \r\n  pivot_longer(everything(), \r\n               names_to = \"attribute\",\r\n               values_to= \"rating\") %>% \r\n  count(attribute,  rating) %>% \r\n  mutate(\r\n    rating = factor(rating, c(\"Strongly agree\", \"Agree\", \"Neutral\", \"Disagree\", \"Strongly disagree\"))\r\n  ) %>% \r\n  ggplot(aes(rating, n))+\r\n  geom_col()+\r\n  coord_flip()+\r\n  facet_wrap(~attribute)\r\n\r\nfaceted_plot\r\n\r\n\r\n\r\n\r\nWhen using facet wrap in ggplots we get the values of the facet column in the strip text. However, since the facet column is actually a column that holds the question, it would be great to have the long label in the facet strip instead of the short name.\r\nThankfully we don’t have to do this manually. We can utilise the label_vector we saved earlier, and the underated ggplot function as_labeller (or sometimes the labeller function).You can read more about as_labeller and labeller for many more (and more usufull) use cases.\r\n\r\n\r\nfaceted_plot+\r\n  facet_wrap(~attribute,labeller = as_labeller(labels_vector))\r\n\r\n\r\n\r\n\r\nAxis text labels\r\nHere we will change how the levels in the axis ticks are displayed.\r\nIm my workflow, very often I need to plot proportions (or other summary statistic) of many items in the survey. Let’s assume we need to plot the proportion of respondents who answered positively ie.. Strongly agree or Agree in the rating questions greeting, food and cost.\r\nOne way of doing this:\r\n-1. Gather all rating questions (lets call them attributes) into a long format table with 2 columns - attribute and the rating for that attribute. -2. Indicate if the rating is positive ie. Agree/ Strongly agree -3. Count tne occurrences of positive rating\r\n\r\n\r\n# Table of good rating percentages\r\n\r\ntbl_pct <- \r\n  dta %>% \r\n  select(greeting, food, cost) %>% \r\n  # step 1\r\n  pivot_longer(everything(), \r\n               names_to = \"attribute\",\r\n               values_to= \"rating\") %>% \r\n  # 2. If Agree/strongly agree then `1` or `0`\r\n  mutate(rating  =  if_else(rating %in% c(\"Agree\",\"Strongly agree\"),1,  0)) %>% \r\n  # 3.Count the occurrences andget proportion\r\n  count(attribute, rating) %>% \r\n  group_by(attribute) %>% \r\n  mutate(pct = n/ sum(n)) \r\n\r\n#the plot\r\nplot_pct <- \r\n  tbl_pct %>% \r\n  # keep only the `1`s i.e. the proportion of agree/sstrongly agree\r\n  filter(rating ==1) %>% \r\n  ggplot(aes(attribute, pct))+\r\n  geom_col()\r\n\r\nplot_pct\r\n\r\n\r\n\r\n\r\nNow, we need to change the cost, food and greeting with appropriate text\r\nI usually use the scale_*_discrete function. There you can define the labels as a named list\r\n\r\n\r\nplot_pct+\r\n  scale_x_discrete(labels = labels_vector)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/2020-12-23-a-workflow-with-labelled-data/a-workflow-with-labelled-data_files/figure-html5/unnamed-chunk-9-1.png",
    "last_modified": "2020-12-29T14:32:42+03:00",
    "input_file": {}
  }
]
